build_publish_validation_test_linux:
  extends: .defaults
  stage: build_test
  tags:
    - linux
  needs:
    - check-code-lint
  before_script:
    - ./build.sh --clean --release
  script:
    - set -eu
    - ./build.sh --config release
    - fail_wr=0
    - ./repo.sh publish_exts --verify
    - ./repo.sh test -s alltests
    - echo "WinRel=${fail_wr}"

  # Artifacts required to make the publishing step work
  artifacts:
    when: on_success
    paths:
    - _build/packages/*
    - _build/**/*.log
    - _repo/*.log
