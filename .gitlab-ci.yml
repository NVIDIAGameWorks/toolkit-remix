.defaults:
  interruptible: true
  allow_failure: false
  variables:
    GIT_STRATEGY: fetch
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event" && $CI_COMMIT_REF_NAME != "master"

variables:
  AWS_ACCESS_KEY_ID: $AWS_OMNIVERSEDOCS_ACCESS_KEY_ID
  AWS_SECRET_ACCESS_KEY: $AWS_OMNIVERSEDOCS_SECRET_ACCESS_KEY

stages:
  - check_changelog
  - check_test_file_location
  - check_format
  - check_lint
  - build_run_tests_and_doc
  - build_doc_publish
  - pkg_publish
  - gitlab_release

include:
  - local: tools/ci/gitlab/check_changelog.yml
  - local: tools/ci/gitlab/check_test_location.yml
  - local: tools/ci/gitlab/check_format.yml
  - local: tools/ci/gitlab/check_lint.yml
  - local: tools/ci/gitlab/run_unit_tests_linux.yml
  - local: tools/ci/gitlab/run_unit_tests_windows_a2o.yml
  - local: tools/ci/gitlab/run_unit_tests_windows_p2z.yml
  - local: tools/ci/gitlab/run_e2e_a2s_tests_windows.yml
  - local: tools/ci/gitlab/run_e2e_t2z_tests_windows.yml
  - local: tools/ci/gitlab/build_doc.yml
  - local: tools/ci/gitlab/publish_extensions.yml
  - local: tools/ci/gitlab/build_doc_publish.yml
  - local: tools/ci/gitlab/pkg_publish.yml
  - local: tools/ci/gitlab/gitlab_release.yml
