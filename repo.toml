########################################################################################################################
# Repo tool base settings
########################################################################################################################

[repo]
logging = "warn"

# Use Kit Template repo configuration as a base. Only override things specific to the repo.
import_configs = ["${root}/_repo/deps/repo_kit_tools/kit-template/repo.toml"]

# Reposiory Name. It is used for solution name and final package name
name = "trex-launcher"

########################################################################################################################
# Test Runner
########################################################################################################################

[repo_test.suites.alltests]
kind = "glob_and_exec"
path = "${test_root}"

[[repo_test.suites.alltests.group]]
# Run app test
include = ["tests-omni.app.lightspeed${shell_ext}"]
exclude = []
args = [
    "--/app/extensions/registryEnabled=0" # It should start ok without a registry enabled (everything prebundled)
]
timeout = 1800

########################################################################################################################
# Packaging
########################################################################################################################

# package content
[repo_package.packages.main_package]
ziponly = true
replace_authors_in_kit_extensions = true
strip_package_infos = true

# package content
files = [
    ["**"],
    # WAR: repo_fileutils fails to package folder starting with dot on windows unless specified explicitly. The reason is that
    # python's std glob module doesn't support finding them. Fixing that turned out to be quite hard.
    ["kit/extscore/omni.kit.pip_archive/pip_prebundle/numpy/.libs"],
]
files_exclude = [
    ["**/*.pdb"],
    ["**/*.exp"],
    ["apps/kit.portable"],
]
"linux-x86_64".files_strip = [
    ["**/*.so"],
]
"linux-x86_64".files_strip_exclude = [
]


########################################################################################################################
# Extensions publisher
########################################################################################################################

[repo_publish_exts]

# Extensions to publish, include and exclude among those discovered by kit. Wildcards are supported.
exts.include = [
    "lightspeed.color_to_normal.core",
    "lightspeed.color_to_normal.menu",
    "lightspeed.color_to_roughness.core",
    "lightspeed.color_to_roughness.menu",
    "lightspeed.common",
    "lightspeed.export",
    "lightspeed.events_manager",
    "lightspeed.event.layers_cleanup",
    "lightspeed.event.save_recent",
    "lightspeed.layer_helpers",
    "lightspeed.layer_manager",
    "lightspeed.lock_xform",
    "lightspeed.progress_popup.window",
    "lightspeed.property_template",
    "lightspeed.stage_column_nickname",
    "lightspeed.tool.material",
    "lightspeed.tool.octahedral_converter",
    "lightspeed.upscale.content_browser.menu",
    "lightspeed.upscale.core",
    "lightspeed.upscale.menu",
    "lightspeed.window.capture_swapper",
    "lightspeed.widget.content_viewer",
    "lightspeed.widget.new_game",
    "lightspeed.widget.new_workspace",
    "lightspeed.window.capture_swapper",
    "lightspeed.window.welcome",
    "lightspeed.workspace",
    "lightspeed_example.app.resources",
    "lightspeed_example.my_name.controller",
    "lightspeed_example.my_name.core",
    "lightspeed_example.my_name.menu",
    "lightspeed_example.my_name.widget",
    "lightspeed_example.my_name.window",
    "lightspeed_example.style",
]
exts.exclude = []

# verify before publishing
publish_verification = true


########################################################################################################################
# Extensions precacher
########################################################################################################################

[repo_precache_exts]
# Apps to run and precache
apps = [
    "${root}/_build/$platform/$config/apps/omni.app.lightspeed.kit"
]



########################################################################################################################
# Documentation building
########################################################################################################################

[repo_docs]
enabled = true

project = "${conf:repo.name}"
name = "Kit Extension Template"
copyright_start = 2021

config = "release"

doxygen_input = [
    "include/omni/example/IBattleSimulator.h",
]

doxygen_aliases = [
]

extra_sys_paths = [
    "${root}/_build/${platform_target}/release/kit/exts/*/bin",
    "${root}/_build/${platform_target}/release/kit/exts/*",
    "${root}/_build/${platform_target}/release/kit/extscore/*",
    "${root}/_build/${platform_target}/release/kit",
    "${root}/_build/${platform_target}/release/kit/plugins",
    "${root}/_build/${platform_target}/release/kit/plugins/bindings-python",
]

sphinx_exclude_patterns = [
    "include",
    "tools",
    "_build",
    "VERSION.md",
]

repo_url = "https://gitlab-master.nvidia.com/omniverse/kit-extensions/kit-template/-/blob/master"

deps = [
    [ "repo_docs", "${root}/_repo/deps/repo_docs/_build/docs/repo_docs/latest"]
]

[repo_docs.editions.s3web]
protocol = "s3"
bucket_name = "omniverse-docs"
bucket_dir = "${project}/${version}"

########################################################################################################################
# Code Format Tool
########################################################################################################################

# C++ is formatted with clang-format:
[repo_format.cpp]
files.include = ["**"]
files.exclude = [
    ".vscode/*",
    "_build/*",
    "_compiler/*",
    "_repo/*",
    ".git/*",
    ".eggs/*",
    ".venv/*",
    "tools/*",
]

# python is formatted with black+isort:
[repo_format.python]
files.include = ["**/*.py"]
files.exclude = [
    ".vscode/*",
    "_build/*",
    "_compiler/*",
    "_repo/*",
    ".git/*",
    ".eggs/*",
    ".venv/*",
    "tools/*",
    "source/*/lightspeed/common/tools/*"
]
python_version = "py37"
job_count = 1


########################################################################################################################
# Python lint tool
########################################################################################################################

[repo_lint]
files.include = ["**/*.py"]
files.exclude = [
    ".vscode/*",
    "_build/*",
    "_compiler/*",
    "_repo/*",
    ".git/*",
    ".eggs/*",
    ".venv/*",
    "tools/*",
    "source/*/lightspeed/common/tools/*"
]

########################################################################################################################
# Launcher publish and deploy
########################################################################################################################

[repo_deploy_launcher]
enabled = true
git_url = "https://oauth2:${env:GITLAB_AUTH_TOKEN}@gitlab-master.nvidia.com/omniverse/trex-release-pipeline.git"
