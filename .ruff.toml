# Ruff configuration - migrated from .flake8
# https://docs.astral.sh/ruff/configuration/

# Keep in sync with [project].requires-python in pyproject.toml
# (Having a separate ruff.toml requires target-version be set here)
target-version = "py310"

line-length = 120

exclude = [
    # Keep in sync with repo.toml [repo_lint.ruff].files.exclude
    # Adding exclusions here allow using the same settings outside of repo tool
    ".eggs",
    ".git",
    ".teamcity",
    ".venv",
    ".vscode",
    "_build",
    "_compiler",
    "_repo",
    "_testoutput",
    "backup.teamcity",
    "portable",
    "source/extensions/example.*",
    "source/extensions/lightspeed.hydra.remix/plugin/usd/usd/resources/codegenTemplates",
    "source/extensions/lightspeed.trex.logic.ogn/python/nodes",
    "source/pythonapps",
    "tools",
    "venv",
]

[format]
# Use LF line endings (matches .gitattributes: * text=auto)
line-ending = "lf"

[lint]
select = [
    # --- Core Python Style (PEP 8) ---
    "E",      # pycodestyle errors: indentation, whitespace, blank lines, imports, line length
    "F",      # pyflakes: undefined names, unused imports/variables, redefinitions
    "N",      # pep8-naming: class/function/variable naming conventions (PascalCase, snake_case)
    "W",      # pycodestyle warnings: deprecated features, indentation warnings

    # --- Imports ---
    # "I",    # isort: Disabled - standalone isort (via format_code.bat) handles import sorting
    "ICN",    # flake8-import-conventions: enforce import aliases (np for numpy, pd for pandas)

    # --- Code Quality ---
    "A",      # flake8-builtins: shadowing Python builtin names (list, dict, id, etc.)
    "B",      # flake8-bugbear: likely bugs and design problems (mutable defaults, assert usage)
    "BLE",    # flake8-blind-except: bare except clauses catching BaseException
    "C4",     # flake8-comprehensions: unnecessary list/dict/set calls, simplify comprehensions
    "PIE800", # flake8-pie: unnecessary spread operator (e.g., [*list] → list)
    "PIE804", # flake8-pie: unnecessary dict kwargs unpacking (**{"k": v} → k=v)
    "PL",     # pylint: broad checker (errors PLE, refactor PLR, warnings PLW, conventions PLC)
    "RET",    # flake8-return: implicit returns, unnecessary return statements, consistency
    "SIM",    # flake8-simplify: if/else simplifications, context managers, boolean expressions
    "ARG",    # flake8-unused-arguments: unused function/method arguments (ARG002-5 ignored, *args/**kwargs ignored)
    # "PERF",   # perflint: performance anti-patterns (unnecessary list(), dict copying) # TODO: enable
    # "S",      # flake8-bandit: security issues (SQL injection, hardcoded passwords, eval) # TODO: enable

    # --- Modernization ---
    "FLY",    # flynt: convert .format() and % to f-strings
    "UP",     # pyupgrade: upgrade syntax for newer Python versions (f-strings, type unions)
    "FURB",   # refurb: modernize code patterns (pathlib, newer stdlib)

    # --- Strings & Formatting ---
    "ISC",    # flake8-implicit-str-concat: implicit string concatenation detection
    "Q",      # flake8-quotes: consistent quote style (single vs double)

    # --- Documentation ---
    "D3",     # pydocstyle: docstring formatting (quotes, whitespace, punctuation) D300-D399
    # "D",      # pydocstyle: full docstring checks (presence, formatting, content) # TODO: enable

    # --- Type Checking ---
    "TC005",   # flake8-type-checking: empty type-checking block (was TCH005)
    # "ANN",    # flake8-annotations: missing type annotations

    # --- Class Design ---
    "SLF",    # flake8-self: private member access from outside class

    # --- Logging ---
    "G",      # flake8-logging-format: logging format string issues (use % not f-strings)
    "LOG",    # flake8-logging: logging anti-patterns (exception(), warn() usage)

    # --- Framework-Specific ---
    "NPY",    # NumPy-specific: NumPy deprecations and best practices

    # --- Ruff-Specific ---
    "RUF022", # __all__ is not sorted
    # Enable this when upgrading ruff versions to clean up:
    # Note: added line ignores for PLC0415 (imports outside toplevel) preemptively for support of ruff 0.12.0+
    # "RUF100", # Unused noqa directive - disabled to avoid cleaning up directives targeting newer versions of ruff

    # --- Version Checks ---
    # "YTT",    # flake8-2020: sys.version comparisons and checks # TODO: catch py310+ issues
]

ignore = [
    # --- Formatter Conflicts (https://docs.astral.sh/ruff/formatter/#conflicting-lint-rules) ---
    # These rules conflict with ruff format and should be disabled
    "W191",    # tab-indentation
    "E111",    # indentation-with-invalid-multiple
    "E114",    # indentation-with-invalid-multiple-comment
    "E117",    # over-indented
    "D300",    # triple-single-quotes
    "Q000",    # bad-quotes-inline-string
    "Q001",    # bad-quotes-multiline-string
    "Q002",    # bad-quotes-docstring
    "Q003",    # avoidable-escaped-quote
    "ISC001",  # single-line-implicit-str-concat - conflicts with formatter (ruff format warns about this)
    "ISC002",  # multi-line-implicit-str-concat - must be ignored alongside ISC001
    "E501",    # line-too-long - formatter handles this best-effort

    # --- Imports ---
    "PLR0402", # Use 'from x import y' instead of 'import x.y as y' - 'import omni.ui as ui' is standard

    # --- Code Quality ---
    "ARG002",  # Unused method argument - common in interface implementations with fixed signatures
    "ARG003",  # Unused class method argument - common in interface implementations with fixed signatures
    "ARG005",  # Unused lambda argument - common in UI callbacks (mouse_pressed_fn, etc.)
    "B905",    # zip() without strict= (Python 3.10+ feature, too noisy)
    "PLR09",   # Too many arguments/branches/statements/returns/etc
    "PLR0917", # Too many positional arguments (preview rule - only shows when preview enabled)
    "PLR2004", # Magic value used in comparison
    "PLW0603", # Using the global statement
    "PLW2901", # Loop/with variable overwritten - common pattern in this codebase
    "RET504",  # Unnecessary variable assignment before return statement
    "SIM103",  # Needless bool - `if x: return True else: return False` → `return x`
    "SIM108",  # Use ternary operator - often hurts readability for complex expressions
    "SIM117",  # Multiple with statements - ignored for omni.ui patterns

    # --- Modernization ---
    "UP038",   # Use `X | Y` in isinstance - removed in ruff 0.13.0 (slower, more verbose)
]

# B008: treat these as immutable (safe to use in default args; eval once, no mutable state).
# Ruff may resolve the call to the short name or the full module path depending on context.
[lint.flake8-bugbear]
extend-immutable-calls = [
    "ServiceBase.describe_query_param",
    "ServiceBase.validate_path_param",
    "omni.flux.service.factory.ServiceBase.describe_query_param",
    "omni.flux.service.factory.ServiceBase.validate_path_param",
    "omni.flux.service.factory.services.base.ServiceBase.describe_query_param",
    "omni.flux.service.factory.services.base.ServiceBase.validate_path_param",
]

[lint.per-file-ignores]
# __doc__ assignments are intentional module docstrings
"*/omni.flux.material_api/*" = ["A001"]
# Tests often need to access private members to verify internal state
"*/tests/*" = ["SLF001", "F403"]

[lint.flake8-unused-arguments]
# Ignore *args and **kwargs - these are intentionally unused in many interfaces
ignore-variadic-names = true

[lint.pydocstyle]
convention = "google"
